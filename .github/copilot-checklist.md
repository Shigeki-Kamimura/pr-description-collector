# Copilot & Codex エージェント チェックリスト

## 📐 設計・コード
- [ ] 関数・クラスの粒度は妥当か（LOC, API公開数, 複雑度を計測）
- [ ] 冗長な依存やデバッグ出力が追加されていないか
- [ ] 命名・コメントは一貫しているか（用語集/スタイルガイドに準拠）
- [ ] O(N)以上の計算やN+1クエリが潜んでいないか
- [ ] コードの重複は最小限に抑えられているか
- [ ] エラーハンドリングは適切に実装されているか

## 🧪 テスト
- [ ] 単体テストはカバレッジ目標（>80%）を満たしているか
- [ ] 境界値・エッジケースのテストが含まれているか
- [ ] 統合テスト・E2Eテストが必要に応じて追加されているか
- [ ] テストの実行時間は許容範囲内か

## 🔒 セキュリティ
- [ ] STRIDEの観点で脅威がないか
- [ ] シークレットやキーがハードコードされていないか
- [ ] 入力検証、リトライ/タイムアウト、サーキットブレーカがあるか
- [ ] 認証・認可のチェックは適切か
- [ ] セキュリティスキャンツールの警告に対応しているか

## ⚡ パフォーマンス / 可観測性
- [ ] p95レイテンシ、CPU/mem、DBコストの劣化がないか
- [ ] ログ/メトリクス/トレースが十分に埋め込まれているか
- [ ] リソース消費の改善がある場合、根拠データが示されているか
- [ ] パフォーマンステストの結果が添付されているか
- [ ] アラート条件が定義・更新されているか

## 💾 SQL
- [ ] ダイアレクト/バージョンを明記しているか
- [ ] EXPLAINを取得し、主要演算の変化を提示しているか
- [ ] インデックス作成時にサイズ/書き込みコスト/ロールバック計画があるか
- [ ] サーガブル条件やKeyset Paginationを使っているか
- [ ] クエリ件数/N+1リスクが説明されているか
- [ ] トランザクション分離レベルは適切か

## 🚀 デプロイメント
- [ ] フィーチャーフラグが適切に使われているか
- [ ] ロールアウト/ロールバック手順があるか
- [ ] CI/CD構成の改変は提案レベルに留まり、直接編集していないか
- [ ] 障害シナリオやリカバリ計画が考慮されているか
- [ ] デプロイ順序の依存関係が明確か

## 📚 ドキュメント
- [ ] API仕様書（OpenAPI/Swagger）が更新されているか
- [ ] READMEやWikiが更新されているか
- [ ] 設計判断の根拠が記録されているか
- [ ] リリースノートの内容が準備されているか

## 🤖 エージェント運用（Codex）チェック
- [ ] **Runbookコマンド**がPR/Issueに明示（`setup/build/verify/test/bench`）
- [ ] **依存関係のバージョン固定**（lockfile/requirements）が更新・レビューされている
- [ ] **Autonomy Budget**（最大ステップ数/実行時間）と**停止条件**（失敗回数・最大Diff）が定義されている
- [ ] **PR分割基準**（≤400行/PR or ディレクトリ単位）が守られ、依存範囲を超える修正は新タスクに切り出されている
- [ ] **Dry-run / 提案モード**で危険領域（CI/Secrets/スキーマ）変更は先に計画提示されている
- [ ] **ログ/ベンチ結果**がPRに保存され、**エージェント実行ログ/出力**も追跡可能になっている
- [ ] **MCP/規約リンク**で一次情報に依拠し、独自仕様を創作していない
- [ ] **Acceptanceの定量基準**（p95/CPU/mem/DBコスト/EXPLAIN差分）が**SLO閾値付きで**満たされている
- [ ] **データ境界/ライセンス/セキュリティ**違反がない（生成物の出典やライセンス表記を含む）
- [ ] **判断ログ**がPRコメントに残され、主要な決定事項が追跡可能になっている
- [ ] **ヒューマンレビュー**が必要な箇所に明示的にコメントが付けられている


## 📋 プロジェクト固有チェック
<!-- プロジェクト特有の追加チェック項目をここに追加 -->
- [ ] 
- [ ] 
- [ ] 

## チェックリスト使用ガイド

### 優先度ラベル
- 🔴 **必須**: すべてのPR/Issueで必ずチェック
- 🟠 **推奨**: 機能追加や大規模変更時にチェック
- 🟢 **任意**: 必要に応じてチェック

### リンク集
- [スタイルガイド](link-to-style-guide)
- [セキュリティポリシー](link-to-security-policy)
- [パフォーマンス基準](link-to-performance-standards)
- [Codexエージェント運用ガイドライン](link-to-codex-guidelines)
